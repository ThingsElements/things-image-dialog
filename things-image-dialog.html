<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../iron-image/iron-image.html">

<link rel="import" href="../things-global-behavior/things-global-behavior.html">

<dom-module id="things-image-dialog">
  <template>
    <style>
      :host {
        display: block;
        background-color:var(--things-whitegrey-background-color);
      }
      paper-toolbar {
        background-color:var(--things-primary-background-color);
        height:45px;
        margin-top:0px !important;
        @apply(--things-padding-clear)
      }  
      paper-toolbar .title {
        margin-left:32px !important;
        line-height:initial !important;
      }
      paper-dialog paper-toolbar:last-child {
        background-color:transparent;
        margin-bottom:5px;
      }      
      .image-container,.image-container *{
        @apply(--layout-flex);
      }
      .image-container iron-image {
        margin:auto;
      }
      .image-container iron-image::shadow img {
        margin:auto;
        max-width:100%
      }
      .image-container {
        @apply(--layout-vertical);
      }
      .image {
        @apply(--layout-vertical);
      }
      .image:first-child {
        @apply(--layout-horizontal);
      }
      .image:last-child::shadow input {
        width:68%;
      }            
      .close-btn {
        @apply(--things-header-button);
        background:url(/images/icon-close.png) 100% 50% no-repeat;
        margin-right:10px;
      }
      .big {
        position: fixed;
        top: 10%;
        bottom: 10%;
        left: 15%;
        right: 15%;
        margin: 0px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .medium {
        position: fixed;
        top: 20%;
        bottom: 20%;
        left: 25%;
        right: 25%;
        margin: 0px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .small {
        position: fixed;
        top: 30%;
        bottom: 30%;
        left: 35%;
        right: 35%;
        margin: 0px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }          
    </style>

    <paper-dialog
      modal
      id="dialog"
      class$="[[dialogSize]]"
      entry-animation="scale-up-animation"
      exit-animation="fade-out-animation">
      <paper-toolbar>
        <span class="title">[[title]]</span>
        <div class="buttonsGroup">
          <button dialog-dismiss class="close-btn"></button>
        </div>
      </paper-toolbar>

      <div class="image-container">
        <div class="image">
          <iron-image src="[[imageUrl]]"></iron-image>
        </div>
      </div>
    </paper-dialog>  
  </template>
  <script>
    Polymer({
      is: 'things-image-dialog',

      behaviors: [
        Things.GlobalBehavior
      ],

      properties: {

        /**
         * dialog title
         */
        title: {
          type: String,
          value: 'Image Dialog'
        },

        /**
         * attachment id
         */
        attachmentId: {
          type: Number
        },

        /**
         * image source url
         */
        imageUrl: {
          type: String
        },

        /**
         * dialog size
         * small < medium < large
         */
        dialogSize: {
          type: String,
          value: 'small'
        },

        /**
         * dialog openCallback
         */
        openCallback: {
          type: Function
        },

        /**
         * dialog closeCallback
         */
        closeCallback: {
          type: Function
        }
      },

      listeners: {
        'dialog.iron-overlay-opened' : '_openHandler',
        'dialog.iron-overlay-closed' : '_closeHandler'
      },

      open: function(title, attachmentId, imageUrl, dialogSize, openCallback, closeCallback) {
        this.title = title;
        
        if(imageUrl && !attachmentId) {
          this.imageUrl = imageUrl;
        } else if (!imageUrl && attachmentId) {
          var baseUrl = this.get('globals.baseUrl');
          this.imageUrl = baseUrl + '/download/' + attachmentId;
        }
        this.dialogSize  = dialogSize;
        this.openCallback = openCallback;
        this.closeCallback = closeCallback;

        this.$['dialog'].open();
      },

      close: function() {
        this.$['dialog'].close();
      },

      _openHandler: function() {
        if(this.openCallback) {
          this.openCallback();
        }
      },

      _closeHandler: function() {
        if(this.closeCallback) {
          this.closeCallback();
        }
      }
    })
  </script>
</dom-module>